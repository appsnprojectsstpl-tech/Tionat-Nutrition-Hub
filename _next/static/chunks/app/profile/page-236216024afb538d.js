(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{8221:(e,s,r)=>{Promise.resolve().then(r.bind(r,10256))},10256:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>$});var a=r(95155),l=r(12115),t=r(6874),n=r.n(t),d=r(62177),i=r(90221),c=r(55594),o=r(85977),m=r(59434);let x=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)(o.bL,{ref:s,className:(0,m.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...l})});x.displayName=o.bL.displayName;let h=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)(o._V,{ref:s,className:(0,m.cn)("aspect-square h-full w-full",r),...l})});h.displayName=o._V.displayName;let u=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)(o.H4,{ref:s,className:(0,m.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...l})});u.displayName=o.H4.displayName;var f=r(26126),j=r(30285),p=r(66695),N=r(54165),g=r(17759),y=r(85127),b=r(62523),v=r(18186),w=r(18763),R=r(77223),A=r(45731),C=r(33349),T=r(34301),k=r(30462),B=r(73158),L=r(40768),F=r(35317),P=r(35695),S=r(52955),H=r(87481),M=r(64190),U=r(93004),z=r(14265),D=r(40154);function E(e){let{onDelete:s,onRefetch:r}=e,{savedAddresses:l}=(0,D.U)(),t=Array.from(new Set(l));return t&&0!==t.length?(0,a.jsx)(a.Fragment,{children:t.map((e,l)=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(v.A,{className:"h-5 w-5 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-sm",children:e})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(z.b,{address:e,onSave:r,children:(0,a.jsx)(j.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})}),(0,a.jsx)(j.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>s(e),children:(0,a.jsx)(R.A,{className:"h-4 w-4"})})]})]},"".concat(e,"-").concat(l)))}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No addresses saved yet. Add your first delivery address."})}let I=c.Ik({firstName:c.Yj().min(1,"First name is required"),lastName:c.Yj().min(1,"Last name is required"),phoneNumber:c.Yj().optional(),avatarUrl:c.Yj().url().optional().or(c.eu(""))}),Z={Bronze:"bg-orange-200 text-orange-800",Silver:"bg-slate-200 text-slate-800",Gold:"bg-yellow-200 text-yellow-800"};function $(){var e,s;let{user:r,auth:t,isUserLoading:c}=(0,L.useAuth)(),o=(0,L.useFirestore)(),v=(0,P.useRouter)(),{toast:w}=(0,H.dj)(),[R,D]=(0,l.useState)(!1),$=(0,L.useMemoFirebase)(()=>o&&r?(0,F.doc)(o,"users",r.uid):null,[o,r]),{data:_,isLoading:Y,refetch:O}=(0,L.useDoc)($),V=(0,L.useMemoFirebase)(()=>o&&r?(0,F.query)((0,F.collection)(o,"users/".concat(r.uid,"/orders")),(0,F.orderBy)("orderDate","desc")):null,[o,r]),{data:W,isLoading:q}=(0,L.useCollection)(V),G=(0,d.mN)({resolver:(0,i.u)(I),defaultValues:{firstName:"",lastName:"",phoneNumber:"",avatarUrl:""}});(0,l.useEffect)(()=>{_&&G.reset({firstName:_.firstName,lastName:_.lastName,phoneNumber:_.phoneNumber||"",avatarUrl:_.avatarUrl||""})},[_,G]);let J=async()=>{if(t)try{await (0,U.CI)(t),w({title:"Logged Out",description:"You have been successfully logged out."}),v.push("/")}catch(e){console.error("Error signing out: ",e),w({title:"Logout Failed",description:"An error occurred while logging out. Please try again.",variant:"destructive"})}};if(c||Y)return(0,a.jsx)("div",{className:"min-h-screen bg-background",children:(0,a.jsx)("main",{className:"container mx-auto px-4 py-8 text-center",children:(0,a.jsx)("p",{children:"Loading profile..."})})});if(!r)return(0,a.jsx)("div",{className:"min-h-screen bg-background",children:(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8 text-center",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold font-headline mb-6",children:"Please Log In"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-8",children:"You need to be logged in to view your profile."}),(0,a.jsx)(j.$,{asChild:!0,children:(0,a.jsx)(n(),{href:"/login?redirect=/profile",children:"Login"})})]})});if(!_&&!Y)return(0,a.jsx)("div",{className:"min-h-screen bg-background",children:(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8 text-center",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold font-headline mb-6",children:"Profile Not Found"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-8",children:"We couldn't find a profile for your account. This can sometimes happen after a new sign-up. Please try refreshing the page or contact support if the issue persists."}),(0,a.jsx)(j.$,{onClick:()=>window.location.reload(),children:"Refresh Page"})]})});if(!_&&Y)return(0,a.jsx)("div",{className:"min-h-screen bg-background",children:(0,a.jsx)("main",{className:"container mx-auto px-4 py-8 text-center",children:(0,a.jsx)("p",{children:"Loading profile..."})})});if(!_)return null;let X="admin"===_.role||"superadmin"===_.role;return(0,a.jsx)("div",{className:"min-h-screen bg-background",children:(0,a.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"grid gap-8 md:grid-cols-3",children:[(0,a.jsx)("div",{className:"md:col-span-1",children:(0,a.jsxs)(p.Zp,{children:[(0,a.jsxs)(p.aR,{className:"flex flex-col items-center text-center",children:[(0,a.jsxs)(x,{className:"w-24 h-24 mb-4",children:[_.avatarUrl&&(0,a.jsx)(h,{src:_.avatarUrl,alt:_.firstName}),(0,a.jsxs)(u,{children:[null==(e=_.firstName)?void 0:e.charAt(0),null==(s=_.lastName)?void 0:s.charAt(0)]})]}),(0,a.jsxs)(p.ZB,{className:"font-headline text-2xl",children:[_.firstName," ",_.lastName]}),(0,a.jsx)(p.BT,{children:_.email})]}),(0,a.jsxs)(p.Wu,{className:"flex flex-col items-center gap-2",children:[X&&(0,a.jsx)(j.$,{asChild:!0,className:"w-full",children:(0,a.jsxs)(n(),{href:"/admin",children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"Admin Dashboard"]})}),(0,a.jsxs)(N.lG,{open:R,onOpenChange:D,children:[(0,a.jsx)(N.zM,{asChild:!0,children:(0,a.jsx)(j.$,{variant:"outline",className:"w-full",children:"Edit Profile"})}),(0,a.jsxs)(N.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(N.c7,{children:[(0,a.jsx)(N.L3,{children:"Edit Profile"}),(0,a.jsx)(N.rr,{children:"Update your personal information."})]}),(0,a.jsx)(g.lV,{...G,children:(0,a.jsxs)("form",{onSubmit:G.handleSubmit(e=>{$&&((0,S.wu)($,e,{merge:!0}),w({title:"Profile Updated",description:"Your information has been successfully saved."}),D(!1))}),className:"space-y-4",children:[(0,a.jsx)(g.zB,{control:G.control,name:"firstName",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"First Name"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(b.p,{...s})}),(0,a.jsx)(g.C5,{})]})}}),(0,a.jsx)(g.zB,{control:G.control,name:"lastName",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"Last Name"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(b.p,{...s})}),(0,a.jsx)(g.C5,{})]})}}),(0,a.jsx)(g.zB,{control:G.control,name:"avatarUrl",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"Avatar URL"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(b.p,{placeholder:"https://example.com/avatar.png",...s})}),(0,a.jsx)(g.C5,{})]})}}),(0,a.jsx)(g.zB,{control:G.control,name:"phoneNumber",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"Phone Number"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(b.p,{placeholder:"e.g. 9876543210",...s})}),(0,a.jsx)(g.C5,{})]})}}),(0,a.jsxs)(N.Es,{children:[(0,a.jsx)(j.$,{type:"button",variant:"ghost",onClick:()=>D(!1),children:"Cancel"}),(0,a.jsx)(j.$,{type:"submit",children:"Save Changes"})]})]})})]})]}),(0,a.jsxs)(j.$,{variant:"ghost",size:"sm",onClick:J,className:"text-red-500 hover:text-red-600",children:[(0,a.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]})}),(0,a.jsxs)("div",{className:"md:col-span-2 space-y-8",children:[(0,a.jsxs)(p.Zp,{children:[(0,a.jsxs)(p.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(p.ZB,{className:"font-headline",children:"Manage Addresses"}),(0,a.jsx)(p.BT,{children:"Add or remove your delivery addresses."})]}),(0,a.jsx)(z.b,{onSave:O,children:(0,a.jsxs)(j.$,{variant:"outline",size:"sm",children:[(0,a.jsx)(T.A,{className:"mr-2 h-4 w-4"}),"Add New"]})})]}),(0,a.jsx)(p.Wu,{className:"space-y-4",children:(0,a.jsx)(E,{onDelete:e=>{$&&confirm("Are you sure you want to delete this address?")&&((0,S.pt)($,{addresses:(0,F.arrayRemove)(e)}),w({title:"Address Removed",description:"The selected address has been deleted.",variant:"destructive"}),O())},onRefetch:O})})]}),(0,a.jsxs)(p.Zp,{children:[(0,a.jsx)(p.aR,{children:(0,a.jsxs)(p.ZB,{className:"flex items-center font-headline",children:[(0,a.jsx)(k.A,{className:"w-6 h-6 mr-2 text-yellow-500"}),"TioRewards Status"]})}),(0,a.jsxs)(p.Wu,{className:"grid gap-6 sm:grid-cols-2",children:[(0,a.jsx)("div",{className:"flex flex-col items-center justify-center p-6 bg-secondary rounded-lg",children:_.loyaltyTier?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(f.E,{className:(0,m.cn)("text-sm font-bold px-4 py-1",Z[_.loyaltyTier]),children:[_.loyaltyTier," Tier"]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"Gold"===_.loyaltyTier?"15% off + early access":"Silver"===_.loyaltyTier?"10% off + free shipping":"5% off basic perks"})]}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"No tier yet."})}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 bg-secondary rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-baseline",children:[(0,a.jsx)("span",{className:"text-4xl font-bold",children:_.loyaltyPoints||0}),(0,a.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Points"})]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"100 points = 25 discount"})]})]})]}),(0,a.jsxs)(p.Zp,{children:[(0,a.jsxs)(p.aR,{children:[(0,a.jsx)(p.ZB,{className:"font-headline",children:"Order History"}),(0,a.jsx)(p.BT,{children:"View your past orders and their status."})]}),(0,a.jsx)(p.Wu,{children:(0,a.jsxs)(y.XI,{children:[(0,a.jsx)(y.A0,{children:(0,a.jsxs)(y.Hj,{children:[(0,a.jsx)(y.nd,{children:"Order ID"}),(0,a.jsx)(y.nd,{children:"Date"}),(0,a.jsx)(y.nd,{children:"Status"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Total"}),(0,a.jsx)(y.nd,{children:(0,a.jsx)("span",{className:"sr-only",children:"View"})})]})}),(0,a.jsxs)(y.BF,{children:[q&&(0,a.jsx)(y.Hj,{children:(0,a.jsx)(y.nA,{colSpan:5,className:"text-center",children:"Loading orders..."})}),W&&W.length>0?W.map(e=>(0,a.jsxs)(y.Hj,{className:"cursor-pointer",onClick:()=>v.push("/profile/order-details?id=".concat(e.id)),children:[(0,a.jsxs)(y.nA,{className:"font-medium",children:["...",e.id.slice(-6)]}),(0,a.jsx)(y.nA,{children:e.orderDate?(0,M.GP)(e.orderDate.toDate(),"MMM d, yyyy"):"N/A"}),(0,a.jsx)(y.nA,{children:(0,a.jsx)(f.E,{variant:"Pending"===e.status?"secondary":"default",children:e.status})}),(0,a.jsx)(y.nA,{className:"text-right",children:e.totalAmount.toFixed(2)}),(0,a.jsx)(y.nA,{className:"text-right",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})]},e.id)):!q&&(0,a.jsx)(y.Hj,{children:(0,a.jsx)(y.nA,{colSpan:5,className:"text-center text-muted-foreground",children:"You haven't placed any orders yet."})})]})]})})]})]})]})})})}},66695:(e,s,r)=>{"use strict";r.d(s,{BT:()=>c,Wu:()=>o,ZB:()=>i,Zp:()=>n,aR:()=>d,wL:()=>m});var a=r(95155),l=r(12115),t=r(59434);let n=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,t.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...l})});n.displayName="Card";let d=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,t.cn)("flex flex-col space-y-1.5 p-6",r),...l})});d.displayName="CardHeader";let i=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,t.cn)("text-2xl font-semibold leading-none tracking-tight",r),...l})});i.displayName="CardTitle";let c=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,t.cn)("text-sm text-muted-foreground",r),...l})});c.displayName="CardDescription";let o=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,t.cn)("p-6 pt-0",r),...l})});o.displayName="CardContent";let m=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,t.cn)("flex items-center p-6 pt-0",r),...l})});m.displayName="CardFooter"},85127:(e,s,r)=>{"use strict";r.d(s,{A0:()=>d,BF:()=>i,Hj:()=>c,XI:()=>n,nA:()=>m,nd:()=>o});var a=r(95155),l=r(12115),t=r(59434);let n=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,t.cn)("w-full caption-bottom text-sm",r),...l})})});n.displayName="Table";let d=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("thead",{ref:s,className:(0,t.cn)("[&_tr]:border-b",r),...l})});d.displayName="TableHeader";let i=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,t.cn)("[&_tr:last-child]:border-0",r),...l})});i.displayName="TableBody",l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,t.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...l})}).displayName="TableFooter";let c=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("tr",{ref:s,className:(0,t.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...l})});c.displayName="TableRow";let o=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("th",{ref:s,className:(0,t.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...l})});o.displayName="TableHead";let m=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("td",{ref:s,className:(0,t.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...l})});m.displayName="TableCell",l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,a.jsx)("caption",{ref:s,className:(0,t.cn)("mt-4 text-sm text-muted-foreground",r),...l})}).displayName="TableCaption"}},e=>{var s=s=>e(e.s=s);e.O(0,[8042,2992,1439,3644,4277,7337,9934,3977,1345,5521,512,6301,9123,1990,8441,1684,7358],()=>s(8221)),_N_E=e.O()}]);